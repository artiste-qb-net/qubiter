

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qubiter.SEO_writer &mdash; qubiter 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> qubiter
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
        
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rosetta.html">Rosetta Stone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classgraph.html">Class Graph</a></li>
</ul>

            
          
        <a href="py-modindex.html">Module Index</a>
    
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">qubiter</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>qubiter.SEO_writer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qubiter.SEO_writer</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qubiter.CktEmbedder</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qubiter.Controls</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qubiter.OneQubitGate</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">qubiter.utilities_gen</span> <span class="k">as</span> <span class="nn">utg</span>
<span class="kn">from</span> <span class="nn">qubiter.PlaceholderManager</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>
<span class="k">if</span> <span class="s1">&#39;autograd.numpy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="SEO_writer"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer">[docs]</a><span class="k">class</span> <span class="nc">SEO_writer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The constructor of this class opens an English and a Picture file. Every</span>
<span class="sd">    other method of the class writes, each time it is called, a single line</span>
<span class="sd">    in each of those 2 files.</span>

<span class="sd">    Note SEO stands for Sequence of Elementary Operations.</span>

<span class="sd">    So what are English and Picture files?</span>

<span class="sd">    We use 3 types of files to characterize a single quantum circuit (in the</span>
<span class="sd">    gate model): (1) an English file (2) a Picture file (3) a Log file.</span>

<span class="sd">    Log files are written by class SEO_reader, whereas English and Picture</span>
<span class="sd">    files are written by this class, SEO_writer.</span>

<span class="sd">    A log file just contains useful information like the number of lines of</span>
<span class="sd">    the English file (same as that of Picture file) and their number of</span>
<span class="sd">    operations.</span>

<span class="sd">    The lines of an English and Picture file are in 1-1 correspondence,</span>
<span class="sd">    each line representing a single operation (e.g., a multi-controlled one</span>
<span class="sd">    qubit gate or a multi-controlled 2 qubit swap).</span>

<span class="sd">    The English file (resp., Picture file) contains complete (resp.,</span>
<span class="sd">    partial, in the form of an ASCII picture) info about the operation</span>
<span class="sd">    specified by each line.</span>

<span class="sd">    In English and Picture files, time flows downward.</span>

<span class="sd">    The class SEO_writer gives the bool option ZL. When this argument is set</span>
<span class="sd">    to True (resp., False), the Picture file shows the zero qubit last (</span>
<span class="sd">    resp., first), and the remaining qubits in consecutive order. Picture</span>
<span class="sd">    files written with zero bit last (resp., first) are labelled prefix +</span>
<span class="sd">    &#39;_ZLpict.text&#39; (resp., prefix + &#39;_ZFpict.txt&#39;). The ZL choice does not</span>
<span class="sd">    affect the English file.</span>

<span class="sd">    See the following and earlier arXiv papers by R.R.Tucci for more info on</span>
<span class="sd">    English and Picture files.</span>

<span class="sd">        http://arxiv.org/abs/1004.2205</span>
<span class="sd">        &quot;Quibbs, a Code Generator for Quantum Gibbs Sampling&quot;</span>

<span class="sd">    The following pdf is stored in the same folder as this python file.</span>

<span class="sd">        qubiter_rosetta_stone.pdf</span>

<span class="sd">    This pdf gives examples of lines in analytic/Picture/English formats.</span>
<span class="sd">    The Picture file examples follow the ZL convention.</span>

<span class="sd">    3 kinds (called 0, 1, 2) of measurements MEAS are allowed. A type 0</span>
<span class="sd">    measurement inserts a projector `|0&gt;&lt;0| = n = P_0` at the target bit. A</span>
<span class="sd">    type 1 measurement inserts a projector `|1&gt;&lt;1| = nbar = P_1` at the target</span>
<span class="sd">    bit. A type 2 measurement stores a copy of the state vector after `|0&gt;&lt;0|`</span>
<span class="sd">    has been applied, and another copy after `|1&gt;&lt;1|` has been applied.</span>

<span class="sd">    If a vertical wire hasn&#39;t been measured as type 2 measurement,</span>
<span class="sd">    it is drawn in pic file as &quot;|&quot;;  otherwise, it is drawn as &quot;:&quot;.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    emb : CktEmbedder</span>
<span class="sd">    english_out : _io.TextIOWrapper</span>
<span class="sd">        file object for output text file that stores English description of</span>
<span class="sd">        circuit</span>
<span class="sd">    file_prefix : str</span>
<span class="sd">        beginning of the name of both English and Picture files</span>
<span class="sd">    gate_line_counter : int</span>
<span class="sd">    indentation : int</span>
<span class="sd">        Starts at 0, Grows by 4 at end of each write_LOOP and decrease by 4</span>
<span class="sd">        at beginning of each write_NEXT</span>
<span class="sd">    measured_bits : list(int)</span>
<span class="sd">        list of bits that have been measured with type 2 measurement and</span>
<span class="sd">        haven&#39;t been reset to `|0&gt;` or `|1&gt;`</span>
<span class="sd">    picture_out : _io.TextIOWrapper</span>
<span class="sd">        file object for output text file that stores ASCII Picture</span>
<span class="sd">        description of circuit</span>
<span class="sd">    ZL : bool</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SEO_writer.__init__"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_prefix</span><span class="p">,</span> <span class="n">emb</span><span class="p">,</span> <span class="n">ZL</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">english_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">picture_out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_prefix : str</span>
<span class="sd">        emb : CktEmbedder</span>
<span class="sd">        ZL : bool</span>
<span class="sd">        english_out : _io.TextIOWrapper</span>
<span class="sd">        picture_out : _io.TextIOWrapper</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gate_line_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">file_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb</span> <span class="o">=</span> <span class="n">emb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ZL</span> <span class="o">=</span> <span class="n">ZL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measured_bits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">english_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">file_prefix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_eng_file_path</span><span class="p">(</span>
                <span class="n">rel</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span> <span class="o">=</span> <span class="n">english_out</span>

        <span class="k">if</span> <span class="n">picture_out</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">file_prefix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pic_file_path</span><span class="p">(</span>
                <span class="n">rel</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span> <span class="o">=</span> <span class="n">picture_out</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="SEO_writer.get_eng_file_path"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.get_eng_file_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_eng_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns path (relative if rel is True, absolute if rel is False) of</span>
<span class="sd">        English file.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        rel : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">utg</span><span class="o">.</span><span class="n">get_eng_file_rel_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span><span class="p">)</span>
        <span class="c1"># print(&quot;..,,mmmm&quot;, rel_path)</span>
        <span class="k">return</span> <span class="n">rel_path</span> <span class="k">if</span> <span class="n">rel</span> <span class="k">else</span> <span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.get_pic_file_path"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.get_pic_file_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_pic_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns path (relative if rel is True, absolute if rel is False) of</span>
<span class="sd">        Picture file.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        rel : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">utg</span><span class="o">.</span><span class="n">get_pic_file_rel_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span><span class="p">,</span>
                                             <span class="n">ZL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ZL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel_path</span> <span class="k">if</span> <span class="n">rel</span> <span class="k">else</span> <span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.close_files"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.close_files">[docs]</a>    <span class="k">def</span> <span class="nf">close_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes English and Picture files that were opened by the constructor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;bbnnnvvv&quot;, &#39;closing files&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="SEO_writer.delete_files"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.delete_files">[docs]</a>    <span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will delete the English and Picture files. The files are</span>
<span class="sd">        closed before being deleted in case that hasn&#39;t been done yet.</span>
<span class="sd">        Closing a file a second time does nothing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_files</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_eng_file_path</span><span class="p">())</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pic_file_path</span><span class="p">())</span></div>

<div class="viewcode-block" id="SEO_writer.gen_html_from_eng_or_pic_file"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.gen_html_from_eng_or_pic_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_html_from_eng_or_pic_file</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a string for an html table generated from an</span>
<span class="sd">        English or Picture file. The table has two columns.</span>
<span class="sd">        The first column gives the line numbers starting from 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        f : file</span>
<span class="sd">            f is file object returned by open()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">all_lines</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">td0</span> <span class="o">=</span> <span class="s2">&quot;&lt;td style=&#39;border-right:1px solid red;&#39;&gt;&quot;</span>
        <span class="n">td1</span> <span class="o">=</span> <span class="s2">&quot;&lt;td style=&#39;text-align:left;&#39;&gt;&quot;</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">all_lines</span> <span class="o">+=</span> <span class="n">td0</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/td&gt;&quot;</span> <span class="o">+</span> <span class="n">td1</span> <span class="o">+</span>\
                         <span class="s2">&quot;&lt;pre&gt;&quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&lt;/pre&gt;&quot;</span> <span class="o">+</span>\
                         <span class="s1">&#39;&lt;/td&gt;&lt;/tr&gt;&#39;</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;&lt;table style=&#39;font-family:monospace&#39;&gt;&lt;tr&gt;&quot;</span> <span class="o">+</span>\
                <span class="n">all_lines</span> <span class="o">+</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span>
        <span class="c1"># print(table)</span>
        <span class="k">return</span> <span class="n">table</span></div>

<div class="viewcode-block" id="SEO_writer.print_eng_file"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.print_eng_file">[docs]</a>    <span class="k">def</span> <span class="nf">print_eng_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jup</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints English file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        jup : bool</span>

<span class="sd">            If jup=False, it prints text. Otherwise, it draws in a jupyter</span>
<span class="sd">            notebook a table with line numbers starting at 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_eng_file_path</span><span class="p">(</span><span class="n">rel</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jup</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dis_obj</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="n">SEO_writer</span><span class="o">.</span><span class="n">gen_html_from_eng_or_pic_file</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="n">display</span><span class="p">(</span><span class="n">dis_obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.print_pic_file"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.print_pic_file">[docs]</a>    <span class="k">def</span> <span class="nf">print_pic_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jup</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints Picture file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        jup : bool</span>
<span class="sd">            If jup=False, it prints text. Otherwise, it draws in a jupyter</span>
<span class="sd">            notebook a table with line numbers starting at 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">utg</span><span class="o">.</span><span class="n">preface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pic_file_path</span><span class="p">(</span><span class="n">rel</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jup</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dis_obj</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="n">SEO_writer</span><span class="o">.</span><span class="n">gen_html_from_eng_or_pic_file</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="n">display</span><span class="p">(</span><span class="n">dis_obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.colonize"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.colonize">[docs]</a>    <span class="k">def</span> <span class="nf">colonize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pic_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns new version of pic_line. Every &quot;|&quot; wire is</span>
<span class="sd">        replaced by &quot;:&quot; colon wire and vice versa iff the wire is at a bit</span>
<span class="sd">        position that has been measured (type 2 measurement) in the past and</span>
<span class="sd">        not reset. This function assumes pic_line in ZL convention so must</span>
<span class="sd">        call this function before calling write_ZF_or_ZL_pic_line()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pic_line : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_qbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">li</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_qbits</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">num_qbits</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_bits</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">li</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;|&quot;</span><span class="p">:</span>
                    <span class="n">li</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">li</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">:</span>
                    <span class="n">li</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">li</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_ZF_or_ZL_pic_line"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_ZF_or_ZL_pic_line">[docs]</a>    <span class="k">def</span> <span class="nf">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pic_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a line in the Picture file using either the ZF or ZL</span>
<span class="sd">        conventions. pic_line is originally written in ZL format, so this</span>
<span class="sd">        method does nothing to pic_line if ZL option is chosen but reverses</span>
<span class="sd">        order of gates if ZF option chosen.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pic_line : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># example:</span>
        <span class="c1"># Ry--R---&lt;---&gt;---Rz</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZL</span><span class="p">:</span>
            <span class="n">pic_line</span> <span class="o">=</span> <span class="n">pic_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># delimiter is -- or --- or 2 spaces or 3 spaces</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-{2,3}| {2,3}&#39;</span><span class="p">,</span> <span class="n">pic_line</span><span class="p">)</span>
            <span class="n">dash_or_space</span> <span class="o">=</span> <span class="p">[</span><span class="n">pic_line</span><span class="p">[</span><span class="n">k</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
            <span class="n">dash_or_space</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">dash_or_space</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span>
                <span class="k">elif</span> <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&gt;&gt;&#39;</span>
                <span class="k">elif</span> <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>
                <span class="k">elif</span> <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">:</span>
                    <span class="n">nodes</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&lt;&lt;&#39;</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">new_line</span> <span class="o">+=</span> <span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">dash_or_space</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">new_line</span> <span class="o">+=</span> <span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">dash_or_space</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># k = len(nodes) - 1</span>
                    <span class="n">new_line</span> <span class="o">+=</span> <span class="n">nd</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">pic_line</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_IF_M_beg"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_IF_M_beg">[docs]</a>    <span class="k">def</span> <span class="nf">write_IF_M_beg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;IF_M( &lt;controls&gt; ){&#39; line in eng &amp; pic files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trols : Controls</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aft_trols</span> <span class="o">=</span> <span class="n">trols</span><span class="o">.</span><span class="n">new_embedded_self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;IF_M(</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_controls</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="s2">&quot;T&quot;</span> <span class="k">if</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">){</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">num_controls</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_IF_M_end"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_IF_M_end">[docs]</a>    <span class="k">def</span> <span class="nf">write_IF_M_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes an &#39;}IF_M&#39; line in eng and pic files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;}IF_M</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_LOOP"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_LOOP">[docs]</a>    <span class="k">def</span> <span class="nf">write_LOOP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_num</span><span class="p">,</span> <span class="n">nreps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;LOOP&#39; line in eng &amp; pic files. The gates between a LOOP</span>
<span class="sd">        line and its partner NEXT line are to be repeated a number of times</span>
<span class="sd">        called nreps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop_num : int</span>
<span class="sd">        nreps : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;LOOP</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">loop_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">NREPS=</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nreps</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+=</span> <span class="mi">4</span></div>

<div class="viewcode-block" id="SEO_writer.write_MEAS"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_MEAS">[docs]</a>    <span class="k">def</span> <span class="nf">write_MEAS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">kind</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;MEAS&#39; line in eng &amp; pic files. This denotes a measurement</span>
<span class="sd">        step. We allow 3 kinds of measurements (0, 1, 2) at a target bit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        kind : int</span>
<span class="sd">            either 0, 1 or 2</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># num_qbits_bef = self.emb.num_qbits_bef</span>
        <span class="n">num_qbits_aft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">aft_tar_bit_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">aft</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;unsupported measurement kind&quot;</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measured_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aft_tar_bit_pos</span><span class="p">)</span>

        <span class="c1"># english file</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;MEAS</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">AT</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">aft_tar_bit_pos</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>

        <span class="c1"># picture file</span>
        <span class="n">pic_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">biggest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="c1"># k a bit position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qbits_aft</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">biggest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;M0  &quot;</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s1">&#39;M1  &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s1">&#39;M   &#39;</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">pic_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colonize</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_NEXT"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_NEXT">[docs]</a>    <span class="k">def</span> <span class="nf">write_NEXT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;NEXT&#39; line in eng &amp; pic files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop_num : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">-=</span> <span class="mi">4</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;NEXT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">loop_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_NOTA"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_NOTA">[docs]</a>    <span class="k">def</span> <span class="nf">write_NOTA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bla_str</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;NOTA&#39; line in eng &amp; pic files. As the name implies,</span>
<span class="sd">        a NOTA is just a note or comment such as &quot;I love you Mary&quot;. It is</span>
<span class="sd">        not a gate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bla_str : str</span>
<span class="sd">        permission : bool</span>
<span class="sd">            General permission, useful for turning off whole batches of NOTAs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">permission</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;NOTA</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bla_str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_PRINT"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_PRINT">[docs]</a>    <span class="k">def</span> <span class="nf">write_PRINT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a &#39;PRINT&#39; line in eng &amp; pic files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        style : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;PRINT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.rads_to_degs_str"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.rads_to_degs_str">[docs]</a>    <span class="k">def</span> <span class="nf">rads_to_degs_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns</span>

<span class="sd">        str(rads*180/pi) if isinstance(rads, float)</span>

<span class="sd">        rads if is_legal_var_name(rads) (this implies rads is str)</span>

<span class="sd">        aborts otherwise.</span>

<span class="sd">        The method is only used inside this class so I am making it</span>
<span class="sd">        non-static even though it doesn&#39;t use self.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rads : float | str </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;--nnn&quot;, type(rads))</span>
        <span class="c1"># np.float types are different from float!!!</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rads</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
            <span class="c1"># print(&quot;--nnn&quot;, str(rads*180/np.pi))</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0:0.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rads</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_legal_var_name</span><span class="p">(</span><span class="n">rads</span><span class="p">),</span> \
                <span class="s2">&quot;attempting to write an illegal variable name: &#39;&quot;</span> <span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="n">rads</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="k">return</span> <span class="n">rads</span></div>

<div class="viewcode-block" id="SEO_writer.write_controlled_preamble"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_controlled_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">write_controlled_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is an internal function, used as preamble to all methods that</span>
<span class="sd">        are named write_controlled_...()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trols : Controls</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Controls</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gate_line_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">closed</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">closed</span>

        <span class="n">aft_trols</span> <span class="o">=</span> <span class="n">trols</span><span class="o">.</span><span class="n">new_embedded_self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
        <span class="c1"># add extra controls if there are any</span>
        <span class="n">extra_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">extra_controls</span><span class="o">.</span><span class="n">bit_pos_to_kind</span>
        <span class="k">if</span> <span class="n">extra_dict</span><span class="p">:</span>
            <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos_to_kind</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_dict</span><span class="p">)</span>
            <span class="n">aft_trols</span><span class="o">.</span><span class="n">refresh_lists</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">aft_trols</span></div>

<div class="viewcode-block" id="SEO_writer.write_controlled_one_qbit_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_controlled_one_qbit_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_controlled_one_qbit_gate</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">one_qbit_gate_fun</span><span class="p">,</span> <span class="n">fun_arg_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a line in eng &amp; pic files for a one bit gate (from class </span>
<span class="sd">        OneQubitGate) with &gt;= 0 controls. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        trols : Controls</span>
<span class="sd">        one_qbit_gate_fun : function</span>
<span class="sd">            maps Any-&gt;np.ndarray</span>
<span class="sd">        fun_arg_list : list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aft_trols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_preamble</span><span class="p">(</span><span class="n">trols</span><span class="p">)</span>

        <span class="c1"># num_qbits_bef = self.emb.num_qbits_bef</span>
        <span class="n">num_qbits_aft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">aft_tar_bit_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">aft</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">)</span>

        <span class="c1"># number of controls may be zero</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">aft_tar_bit_pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">,</span>\
            <span class="s2">&quot;target bit cannot be a control bit&quot;</span>

        <span class="k">if</span> <span class="n">fun_arg_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fun_arg_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># english file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">had2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;HAD2&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">phase_fac</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;PHAS</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_0_phase_fac</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;P0PH</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;P1PH</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span><span class="p">:</span>
            <span class="n">ang_rads</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">degs_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">ang_rads</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ROTX</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">degs_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ROTY</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">degs_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ROTZ</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">degs_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot</span><span class="p">:</span>
            <span class="n">x_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">z_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ROTN</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="n">x_degs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">y_degs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">z_degs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SIGX&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SIGY&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigz</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SIGZ&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">u2</span><span class="p">:</span>
            <span class="n">ph_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">y_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">z_degs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;U_2_</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ph_degs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="n">x_degs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">y_degs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">z_degs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;writing an unsupported controlled gate</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
                            <span class="n">one_qbit_gate_fun</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">AT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">aft_tar_bit_pos</span><span class="p">)</span> <span class="o">+</span>
                               <span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">IF</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">num_controls</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># list bit-positions in decreasing order</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_controls</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;T&quot;</span> <span class="k">if</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">num_controls</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># picture file</span>
        <span class="n">pic_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">biggest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="k">if</span> <span class="n">num_controls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aft_tar_bit_pos</span><span class="p">)</span>
            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">num_controls</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">aft_tar_bit_pos</span><span class="p">)</span>

        <span class="c1"># k a bit position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qbits_aft</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">biggest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">c_int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">biggest</span><span class="p">,</span> <span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">is_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">aft_tar_bit_pos</span><span class="p">)</span>
            <span class="n">is_control</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">control_kind</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;---&quot;</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;--&quot;</span>

            <span class="c1"># c_int starts at last value</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span> <span class="n">num_controls</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">is_control</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">control_kind</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">c_int</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">is_control</span><span class="p">:</span>
                <span class="n">pic_line</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;@&quot;</span> <span class="k">if</span> <span class="n">control_kind</span> <span class="k">else</span> <span class="s2">&quot;O&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">tres</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is not control</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_target</span><span class="p">:</span>  <span class="c1"># is not control or target</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is target</span>
                    <span class="k">if</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">had2</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;H&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">phase_fac</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Ph&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_0_phase_fac</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;OP&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;@P&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span><span class="p">:</span>
                        <span class="n">axis</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Rx&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Ry&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Rz&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="kc">False</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;R&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;X&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigy</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Y&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigz</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Z&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">elif</span> <span class="n">one_qbit_gate_fun</span> <span class="o">==</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">u2</span><span class="p">:</span>
                        <span class="n">rads1</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">rads2</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">rads3</span> <span class="o">=</span> <span class="n">fun_arg_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                        <span class="k">def</span> <span class="nf">both_are_small</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                <span class="k">return</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">False</span>
                            <span class="k">return</span> <span class="kc">True</span>

                        <span class="n">small_12</span> <span class="o">=</span> <span class="n">both_are_small</span><span class="p">(</span><span class="n">rads1</span><span class="p">,</span> <span class="n">rads2</span><span class="p">)</span>
                        <span class="n">small_23</span> <span class="o">=</span> <span class="n">both_are_small</span><span class="p">(</span><span class="n">rads2</span><span class="p">,</span> <span class="n">rads3</span><span class="p">)</span>
                        <span class="n">small_13</span> <span class="o">=</span> <span class="n">both_are_small</span><span class="p">(</span><span class="n">rads1</span><span class="p">,</span> <span class="n">rads3</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">small_12</span> <span class="ow">and</span> <span class="n">small_23</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Ph&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">elif</span> <span class="n">small_23</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Ux&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">elif</span> <span class="n">small_13</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Uy&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">elif</span> <span class="n">small_12</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Uz&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;U&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> \
                            <span class="s2">&quot;writing an unsupported controlled gate</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
                            <span class="n">one_qbit_gate_fun</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">pic_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colonize</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_controlled_qbit_swap"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_controlled_qbit_swap">[docs]</a>    <span class="k">def</span> <span class="nf">write_controlled_qbit_swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit1</span><span class="p">,</span> <span class="n">bit2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">rads_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If rads_list=None, this method writes a line in eng &amp; pic files for</span>
<span class="sd">        a &#39;SWAP&#39; with &gt;= 0 controls</span>

<span class="sd">        NOTE: SWAP is qbit symmetric: SWAP(0,1) = SWAP(1,0)</span>

<span class="sd">        If rads_list is not None and equals a list of 2 angles, rads_list=[</span>
<span class="sd">        rads0, rads1], this method writes a generalization of SWAP that I</span>
<span class="sd">        call SWAY (just to have a verb that is close to swap)</span>

<span class="sd">        SWAY  =</span>
<span class="sd">        [1  0  0]</span>
<span class="sd">        [0  U2 0]</span>
<span class="sd">        [0  0  1]</span>

<span class="sd">        where U2 is the most general 2-dim unitary matrix satisfying</span>

<span class="sd">        sigx U2 sigx = U2.</span>

<span class="sd">        If U2 is parametrized as</span>

<span class="sd">        U2 = exp(j*(rads0 + rads1*sigx + rads2*sigy + rads3*sigz))</span>

<span class="sd">        then SWAY is qbit symmetric (SWAY(0,1)=SWAY(1,0)) iff sigx U2 sigx</span>
<span class="sd">        = U2 iff rads2=rads3=0.</span>

<span class="sd">        SWAY includes SWAP, sqrt(SWAP), iSWAP, sqrt(iSWAP), PWAP,</span>
<span class="sd">        sqrt(PSWAP) etc.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bit1 : int</span>
<span class="sd">        bit2 : int</span>
<span class="sd">            bit1 and bit2 are the positions of the swapped bits.</span>
<span class="sd">        trols : Controls</span>
<span class="sd">        rads_list : list[float | str ] | None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aft_trols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_preamble</span><span class="p">(</span><span class="n">trols</span><span class="p">)</span>

        <span class="n">num_qbits_bef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_bef</span>
        <span class="n">num_qbits_aft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="c1"># aft_tar_bit_pos = self.emb.aft(tar_bit_pos)</span>

        <span class="c1"># number of controls may be zero</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">bit1</span> <span class="o">!=</span> <span class="n">bit2</span><span class="p">,</span> <span class="s2">&quot;swapped bits must be different&quot;</span>
        <span class="k">assert</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">bit1</span> <span class="o">&lt;</span> <span class="n">num_qbits_bef</span>
        <span class="k">assert</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">bit2</span> <span class="o">&lt;</span> <span class="n">num_qbits_bef</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">aft</span><span class="p">(</span><span class="n">bit1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">aft</span><span class="p">(</span><span class="n">bit2</span><span class="p">)]</span>
        <span class="n">big</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">small</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">use_sway</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">rads_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rads_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="n">use_sway</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># english file</span>
        <span class="n">gate_name</span> <span class="o">=</span> <span class="s1">&#39;SWAP&#39;</span>
        <span class="k">if</span> <span class="n">use_sway</span><span class="p">:</span>
            <span class="n">gate_name</span> <span class="o">=</span> <span class="s1">&#39;SWAY&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span> <span class="n">gate_name</span> <span class="o">+</span>
                               <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">big</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">small</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">use_sway</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">BY&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">deg_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">rads_list</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">deg_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">IF</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">num_controls</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># list bit-positions in decreasing order</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_controls</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;T&quot;</span> <span class="k">if</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">num_controls</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># picture file</span>
        <span class="n">pic_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">biggest</span> <span class="o">=</span> <span class="n">big</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">small</span>
        <span class="k">if</span> <span class="n">num_controls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">big</span><span class="p">)</span>
            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">num_controls</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">small</span><span class="p">)</span>

        <span class="c1"># k a bit position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qbits_aft</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">biggest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">c_int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">biggest</span><span class="p">,</span> <span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">is_big</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">big</span><span class="p">)</span>
            <span class="n">is_small</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">small</span><span class="p">)</span>
            <span class="n">is_control</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">control_kind</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;---&quot;</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;--&quot;</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span> <span class="n">num_controls</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">is_control</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">control_kind</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">c_int</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">is_control</span><span class="p">:</span>
                <span class="n">pic_line</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;@&#39;</span> <span class="k">if</span> <span class="n">control_kind</span> <span class="k">else</span> <span class="s1">&#39;O&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">tres</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># control not found</span>
                <span class="k">if</span> <span class="n">is_big</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">use_sway</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;&lt;&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">elif</span> <span class="n">is_small</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">use_sway</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;&gt;&gt;&quot;</span> <span class="o">+</span> <span class="n">dos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="n">tres</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">pic_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colonize</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_controlled_multiplexor_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_controlled_multiplexor_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_controlled_multiplexor_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a line in eng &amp; pic files for a multiplexor &#39;MP_Y&#39; with &gt;= 0</span>
<span class="sd">        controls of either int (integer, intrinsic) or True/False kind.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        trols : Controls</span>
<span class="sd">        rad_angles : list[float]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aft_trols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_preamble</span><span class="p">(</span><span class="n">trols</span><span class="p">)</span>

        <span class="c1"># num_qbits_bef = self.emb.num_qbits_bef</span>
        <span class="n">num_qbits_aft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">aft_tar_bit_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">aft</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">)</span>

        <span class="c1"># number of controls may be zero</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="n">aft_tar_bit_pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">,</span>\
            <span class="s2">&quot;target bit cannot be a control bit&quot;</span>

        <span class="n">num_int_controls</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">get_num_int_controls</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">num_int_controls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> \
            <span class="s2">&quot;multiplexor with no half-moon controls&quot;</span>
        <span class="n">num_angles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rad_angles</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_angles</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">num_int_controls</span><span class="p">),</span>\
            <span class="s2">&quot;wrong number of multiplexor angles&quot;</span>
        
        <span class="c1"># english file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span>
            <span class="s2">&quot;MP_Y</span><span class="se">\t</span><span class="s2">AT</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">aft_tar_bit_pos</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">IF</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># list bit-positions in decreasing order</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_controls</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># bool is subclass of int</span>
            <span class="c1"># so isinstance(x, int) will be true if x is bool!</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">+</span> <span class="n">kind_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># use BY to indicate end of controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">BY</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_angles</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">rad_angles</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_angles</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>
        
        <span class="c1"># picture file</span>
        <span class="n">pic_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">biggest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">aft_tar_bit_pos</span>
        <span class="k">if</span> <span class="n">num_controls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aft_tar_bit_pos</span><span class="p">)</span>
            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">num_controls</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">aft_tar_bit_pos</span><span class="p">)</span>

        <span class="c1"># k a bit position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qbits_aft</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">biggest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">c_int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">biggest</span><span class="p">,</span> <span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">is_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">tar_bit_pos</span><span class="p">)</span>
            <span class="n">is_control</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">control_kind</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;---&quot;</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;--&quot;</span>

            <span class="c1"># c_int starts at last value</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span> <span class="n">num_controls</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">is_control</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">control_kind</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">c_int</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">is_control</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_kind</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">control_kind</span><span class="p">:</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;O&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">elif</span> <span class="n">control_kind</span><span class="p">:</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">tres</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is not control</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_target</span><span class="p">:</span>  <span class="c1"># is not control nor target</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is target</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;Ry&quot;</span> <span class="o">+</span> <span class="n">dos</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">pic_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colonize</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_controlled_diag_unitary_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_controlled_diag_unitary_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_controlled_diag_unitary_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a line in eng &amp; pic files for a diagonal unitary gate &#39;DIAG&#39;</span>
<span class="sd">        with &gt;= 0 controls of either int (integer, intrinsic) or True/False</span>
<span class="sd">        kind.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trols : Controls</span>
<span class="sd">        rad_angles : list[float]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aft_trols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_preamble</span><span class="p">(</span><span class="n">trols</span><span class="p">)</span>

        <span class="c1"># num_qbits_bef = self.emb.num_qbits_bef</span>
        <span class="n">num_qbits_aft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="c1"># aft_tar_bit_pos = self.emb.aft(tar_bit_pos)</span>

        <span class="c1"># number of controls may be zero</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>

        <span class="n">num_int_controls</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">get_num_int_controls</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">num_int_controls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> \
            <span class="s2">&quot;d-unitary with no half-moon controls&quot;</span>
        <span class="n">num_angles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rad_angles</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_angles</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">num_int_controls</span><span class="p">),</span>\
            <span class="s2">&quot;wrong number of d-unitary angles&quot;</span>

        <span class="c1"># english file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indentation</span> <span class="o">+</span>
                               <span class="s2">&quot;DIAG</span><span class="se">\t</span><span class="s2">IF</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># list bit-positions in decreasing order</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_controls</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># bool is subclass of int</span>
            <span class="c1"># so isinstance(x, int) will be true if x is bool!</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
            <span class="k">elif</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">kind_str</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">+</span> <span class="n">kind_str</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># use BY to indicate end of controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">BY</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_angles</span><span class="p">):</span>
            <span class="c1"># print(&#39;nmnmkkk&#39;, k, num_angles, rad_angles[k])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">english_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rads_to_degs_str</span><span class="p">(</span><span class="n">rad_angles</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span>
                <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="p">(</span><span class="n">num_angles</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># picture file</span>
        <span class="n">pic_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">biggest</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">smallest</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">num_controls</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># k a bit position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qbits_aft</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">biggest</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">c_int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">biggest</span><span class="p">,</span> <span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">is_control</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">control_kind</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tres</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">smallest</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;---&quot;</span>

            <span class="c1"># c_int starts at last value</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c_int</span><span class="p">,</span> <span class="n">num_controls</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">is_control</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">control_kind</span> <span class="o">=</span> <span class="n">aft_trols</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">c_int</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">is_control</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_kind</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">control_kind</span><span class="p">:</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;O&quot;</span> <span class="o">+</span> <span class="n">tres</span>
                <span class="k">elif</span> <span class="n">control_kind</span><span class="p">:</span>
                    <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">tres</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># is not control</span>
                <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span> <span class="o">+</span> <span class="n">tres</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">smallest</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">pic_line</span> <span class="o">+=</span> <span class="s2">&quot;|   &quot;</span>

        <span class="n">pic_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colonize</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_ZF_or_ZL_pic_line</span><span class="p">(</span><span class="n">pic_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_one_qbit_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_one_qbit_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_one_qbit_gate</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">one_qbit_gate_fun</span><span class="p">,</span> <span class="n">fun_arg_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a line in eng &amp; pic files for a one qubit gate (from class</span>
<span class="sd">        OneQubitGate) with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        one_qbit_gate_fun : function</span>
<span class="sd">        fun_arg_list : list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># dummy with zero controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span>
            <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">one_qbit_gate_fun</span><span class="p">,</span> <span class="n">fun_arg_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_qbit_swap"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_qbit_swap">[docs]</a>    <span class="k">def</span> <span class="nf">write_qbit_swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bit1</span><span class="p">,</span> <span class="n">bit2</span><span class="p">,</span> <span class="n">rads_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a line in eng &amp; pic files for a &#39;SWAP&#39; if rads_list=None or</span>
<span class="sd">        &#39;SWAY&#39; if rads_list!=None, with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bit1 : int</span>
<span class="sd">        bit2 : int</span>
<span class="sd">        rads_list : list[float | str] | None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># dummy with zero controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_qbit_swap</span><span class="p">(</span><span class="n">bit1</span><span class="p">,</span> <span class="n">bit2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">rads_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_H"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_H">[docs]</a>    <span class="k">def</span> <span class="nf">write_H</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes HAD2 with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">had2</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_Rx"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Rx">[docs]</a>    <span class="k">def</span> <span class="nf">write_Rx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">rads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        writes ROTX = exp(1j*rads*sig_x) with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        rads : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span><span class="p">,</span> <span class="p">[</span><span class="n">rads</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_Ry"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Ry">[docs]</a>    <span class="k">def</span> <span class="nf">write_Ry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">rads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes ROTY = exp(1j*rads*sig_y) with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        rads : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span><span class="p">,</span> <span class="p">[</span><span class="n">rads</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_Rz"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Rz">[docs]</a>    <span class="k">def</span> <span class="nf">write_Rz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">rads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes ROTZ = exp(1j*rads*sig_z) with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        rads : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span><span class="p">,</span> <span class="p">[</span><span class="n">rads</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_Rn"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Rn">[docs]</a>    <span class="k">def</span> <span class="nf">write_Rn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">rads_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes</span>

<span class="sd">        ROTN = exp(1j*(rads_x*sig_x + rads_y*sig_y + rads_z*sig_z))</span>

<span class="sd">        with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        rads_list : list[float]</span>
<span class="sd">            [rads_x, rads_y, rads_z]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="n">rads_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_S"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_S">[docs]</a>    <span class="k">def</span> <span class="nf">write_S</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">herm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes P1PH = exp(1j*P_1*pi/2) or its Hermitian with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        herm : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">herm</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">sign</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_T"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_T">[docs]</a>    <span class="k">def</span> <span class="nf">write_T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">herm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes P1PH = exp(1j*P_1*pi/4) or its Hermitian with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        herm : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">herm</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span><span class="p">,</span>
                                <span class="p">[</span><span class="n">sign</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_U2"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_U2">[docs]</a>    <span class="k">def</span> <span class="nf">write_U2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">rads_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes</span>

<span class="sd">        UN_2= exp(1j*(rads0 + rads1*sig_x + rads2*sig_y + rads3*sig_z))</span>

<span class="sd">        with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        rads_list : list[float]</span>
<span class="sd">            [rads0, rads1, rads2, rads3]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">u2</span><span class="p">,</span> <span class="n">rads_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_X"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_X">[docs]</a>    <span class="k">def</span> <span class="nf">write_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes SIGX with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_Y"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Y">[docs]</a>    <span class="k">def</span> <span class="nf">write_Y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes SIGY with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigy</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_Z"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_Z">[docs]</a>    <span class="k">def</span> <span class="nf">write_Z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes SIGZ with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigz</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_cnot"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_cnot">[docs]</a>    <span class="k">def</span> <span class="nf">write_cnot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">target_bit</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a simple singly controlled not. If kind=True (resp. False),</span>
<span class="sd">        cnot fires when control is `|1&gt;` (resp. `|0&gt;`).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        control_bit : int</span>
<span class="sd">        target_bit : int</span>
<span class="sd">        kind : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_qbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="o">.</span><span class="n">new_single_trol</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="n">target_bit</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span>
            <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_cz"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_cz">[docs]</a>    <span class="k">def</span> <span class="nf">write_cz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">target_bit</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a simple singly controlled Z. If kind=True (resp. False),</span>
<span class="sd">        cz fires when control is `|1&gt;` (resp. `|0&gt;`).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        control_bit : int</span>
<span class="sd">        target_bit : int</span>
<span class="sd">        kind : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_qbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="o">.</span><span class="n">new_single_trol</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="n">target_bit</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span>
            <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigz</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_c_P1PH"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_c_P1PH">[docs]</a>    <span class="k">def</span> <span class="nf">write_c_P1PH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">target_bit</span><span class="p">,</span> <span class="n">rads</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a simple singly controlled P1PH. If kind=True (resp. False),</span>
<span class="sd">        c_P1PH fires when control is `|1&gt;` (resp. `|0&gt;`). When kind= True and</span>
<span class="sd">        rads=p1, c_P1PH equals `(-1)^{n(t)n(c)} = sigz(t)^{n(c)}` where c is</span>
<span class="sd">        the control and t is the target. This is often called a controlled</span>
<span class="sd">        Z, and denoted by Cz.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        control_bit : int</span>
<span class="sd">        target_bit : int</span>
<span class="sd">        rads : float</span>
<span class="sd">        kind : bool</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_qbits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">num_qbits_aft</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="o">.</span><span class="n">new_single_trol</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">,</span> <span class="n">control_bit</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="n">target_bit</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span>
            <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span><span class="p">,</span> <span class="p">[</span><span class="n">rads</span><span class="p">])</span></div>

<div class="viewcode-block" id="SEO_writer.write_global_phase_fac"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_global_phase_fac">[docs]</a>    <span class="k">def</span> <span class="nf">write_global_phase_fac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ang_rads</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a line in eng &amp; pic files for a global phase factor &#39;PHAS&#39;</span>
<span class="sd">        with no controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ang_rads : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tar_bit_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># anyone will do</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># dummy with zero controls</span>
        <span class="n">gate_fun</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">phase_fac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span>
            <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate_fun</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="SEO_writer.write_multiplexor_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_multiplexor_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_multiplexor_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">controls</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a line in eng &amp; pic files for a multiplexor &#39;MP_Y&#39; with</span>
<span class="sd">        no T/F controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tar_bit_pos : int</span>
<span class="sd">        controls : Controls</span>
<span class="sd">        rad_angles : list[float]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">controls</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_controls</span> <span class="o">==</span> <span class="n">controls</span><span class="o">.</span><span class="n">get_num_int_controls</span><span class="p">(),</span>\
            <span class="s2">&quot;some of the controls of this multiplexor are not half-moons&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_multiplexor_gate</span><span class="p">(</span>
            <span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">controls</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">)</span></div>

<div class="viewcode-block" id="SEO_writer.write_diag_unitary_gate"><a class="viewcode-back" href="../../qubiter.SEO_writer.html#qubiter.SEO_writer.SEO_writer.write_diag_unitary_gate">[docs]</a>    <span class="k">def</span> <span class="nf">write_diag_unitary_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controls</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a line in eng &amp; pic files for a diagonal unitary &#39;DIAG&#39; with</span>
<span class="sd">        no T/F controls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        controls : Controls</span>
<span class="sd">        rad_angles : list[float]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_controls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">controls</span><span class="o">.</span><span class="n">bit_pos</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_controls</span> <span class="o">==</span> <span class="n">controls</span><span class="o">.</span><span class="n">get_num_int_controls</span><span class="p">(),</span>\
            <span class="s2">&quot;some of the controls of this diagonal unitary are not half-moons&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_controlled_diag_unitary_gate</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="n">rad_angles</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">num_qbits</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">CktEmbedder</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">,</span> <span class="n">num_qbits</span><span class="p">)</span>
        <span class="n">trols</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">)</span>
        <span class="n">trols</span><span class="o">.</span><span class="n">bit_pos_to_kind</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">trols</span><span class="o">.</span><span class="n">refresh_lists</span><span class="p">()</span>
        <span class="n">ang_rads</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>

        <span class="k">for</span> <span class="n">ZL</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
            <span class="n">wr</span> <span class="o">=</span> <span class="n">SEO_writer</span><span class="p">(</span><span class="s1">&#39;wr_test&#39;</span><span class="p">,</span> <span class="n">emb</span><span class="p">,</span> <span class="n">ZL</span><span class="o">=</span><span class="n">ZL</span><span class="p">)</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_NOTA</span><span class="p">(</span><span class="s1">&#39;zero bit last = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ZL</span><span class="p">))</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_IF_M_beg</span><span class="p">(</span><span class="n">trols</span><span class="p">)</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_IF_M_end</span><span class="p">()</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_LOOP</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_NEXT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

            <span class="n">tar_bit_pos</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">wr</span><span class="o">.</span><span class="n">write_MEAS</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_PRINT</span><span class="p">(</span><span class="s1">&#39;F2&#39;</span><span class="p">)</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_qbit_swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">)</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_qbit_swap</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">phase_fac</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">])</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_global_phase_fac</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_0_phase_fac</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">P_1_phase_fac</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigy</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigz</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">had2</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot_ax</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="p">[</span><span class="n">ang_rads</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">rot</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">trols</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span>
                <span class="p">[</span><span class="n">ang_rads</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="p">])</span>

            <span class="n">gate</span> <span class="o">=</span> <span class="n">OneQubitGate</span><span class="o">.</span><span class="n">sigx</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_one_qbit_gate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">write_cnot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">tar_bit_pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">trols1</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">)</span>
            <span class="n">trols1</span><span class="o">.</span><span class="n">bit_pos_to_kind</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">trols1</span><span class="o">.</span><span class="n">refresh_lists</span><span class="p">()</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_controlled_multiplexor_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols1</span><span class="p">,</span>
                <span class="p">[</span><span class="n">ang_rads</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="p">,</span> <span class="n">ang_rads</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>

            <span class="n">trols2</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">(</span><span class="n">num_qbits</span><span class="p">)</span>
            <span class="n">trols2</span><span class="o">.</span><span class="n">bit_pos_to_kind</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="n">trols2</span><span class="o">.</span><span class="n">refresh_lists</span><span class="p">()</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write_multiplexor_gate</span><span class="p">(</span><span class="n">tar_bit_pos</span><span class="p">,</span> <span class="n">trols2</span><span class="p">,</span>
                <span class="p">[</span><span class="n">ang_rads</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">ang_rads</span><span class="p">,</span> <span class="n">ang_rads</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">])</span>

            <span class="n">wr</span><span class="o">.</span><span class="n">close_files</span><span class="p">()</span>


    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Robert R. Tucci &amp; Qubiter contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>