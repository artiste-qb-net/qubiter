

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qubiter.PlaceholderManager &mdash; qubiter 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> qubiter
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
        
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rosetta.html">Rosetta Stone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classgraph.html">Class Graph</a></li>
</ul>

            
          
        <a href="py-modindex.html">Module Index</a>
    
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">qubiter</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>qubiter.PlaceholderManager</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qubiter.PlaceholderManager</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="s1">&#39;autograd.numpy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">autograd.numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># from SEO_writer import *</span>
<span class="kn">import</span> <span class="nn">qubiter.utilities_gen</span> <span class="k">as</span> <span class="nn">utg</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>


<div class="viewcode-block" id="PlaceholderManager"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager">[docs]</a><span class="k">class</span> <span class="nc">PlaceholderManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The word &quot;placeholder&quot; (as used here and in Tensorflow) refers to a</span>
<span class="sd">    variable whose evaluation is postponed until a later time. In this</span>
<span class="sd">    class, we consider gate angle variables-placeholders.</span>

<span class="sd">    Legal variable names are described in the docstring of the function</span>
<span class="sd">    is_legal_var_name() in this class.</span>

<span class="sd">    An object of this class is owned by SEO_reader and subclasses thereof.</span>
<span class="sd">    When a circuit is read, the methods owned by this class are called to</span>
<span class="sd">    try to replace the placeholders by values. This class owns a dictionary</span>
<span class="sd">    `var_num_to_rads` that is used to store values of all angle variables</span>
<span class="sd">    used in all placeholders. The class also owns a dictionary</span>
<span class="sd">    `fun_name_to_fun` that is used to store functions used in &quot;functional&quot;</span>
<span class="sd">    type placeholders. Together, these 2 dictionaries are used to find a</span>
<span class="sd">    float value (&quot;resolve&quot;) each placeholder.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    all_fun_names : list[str]</span>
<span class="sd">        a list of all the distinct function names encountered in circuit</span>
<span class="sd">    all_var_nums : list[int]</span>
<span class="sd">        a list of all distinct variable numbers encountered in circuit</span>
<span class="sd">    eval_all_vars : bool</span>
<span class="sd">        will abort if this is True and a variable can&#39;t be evaluated</span>
<span class="sd">    fun_name_to_fun : dict[str, function]</span>
<span class="sd">        dictionary mapping a function name to a function</span>
<span class="sd">    fun_name_to_hist : dict[str, list[function|None]]</span>
<span class="sd">        dictionary mapping a function name to its history (a list of</span>
<span class="sd">        function or None). This is only used when using loops in the English</span>
<span class="sd">        file. See LoopFileGenerator and LoopyPlaceholder classes for more</span>
<span class="sd">        info about this variable.</span>
<span class="sd">    fun_name_to_use_count: dict[str, int]</span>
<span class="sd">        dictionary mapping a function name to its current use count (the</span>
<span class="sd">        number of times it has been used. Repeat appearances inside a loop</span>
<span class="sd">        or nested loops are considered as different uses.)</span>
<span class="sd">    no_vars : bool</span>
<span class="sd">        will abort if this is True and a variable is detected</span>
<span class="sd">    var_num_to_hist : dict[int, list[float|None]]</span>
<span class="sd">        dictionary mapping a variable number to its history (a list of float</span>
<span class="sd">        or None). This is only used when using loops in the English file. See</span>
<span class="sd">        LoopFileGenerator and LoopyPlaceholder classes for more info about</span>
<span class="sd">        this variable.</span>
<span class="sd">    var_num_to_rads : dict[int, float]</span>
<span class="sd">        dictionary mapping a variable number to its value in radians</span>
<span class="sd">    var_num_to_use_count : dict[int, int]</span>
<span class="sd">        dictionary mapping a variable number to its current use count (the</span>
<span class="sd">        number of times it has been used. Repeat appearances inside a loop</span>
<span class="sd">        or nested loops are considered as different uses.)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PlaceholderManager.__init__"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_all_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">var_num_to_rads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fun_name_to_fun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        no_vars : bool</span>
<span class="sd">        eval_all_vars : bool</span>
<span class="sd">        var_num_to_rads : dict[int, float]</span>
<span class="sd">            a dict mapping variable numbers to a float for radians. Used by</span>
<span class="sd">            a SEO_reader or its children to evaluate hash prefixed angle</span>
<span class="sd">            variables in a placeholder.</span>
<span class="sd">        fun_name_to_fun : dict[str, function]</span>
<span class="sd">            a dictionary mapping each function name to a function that</span>
<span class="sd">            returns a float that stands for radians. Used by a SEO_reader or</span>
<span class="sd">            its children to evaluate function names in a functional</span>
<span class="sd">            placeholder.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>


<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">no_vars</span> <span class="o">=</span> <span class="n">no_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_all_vars</span> <span class="o">=</span> <span class="n">eval_all_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_rads</span> <span class="o">=</span> <span class="n">var_num_to_rads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_fun</span> <span class="o">=</span> <span class="n">fun_name_to_fun</span>

        <span class="c1"># will be filled by this class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_var_nums</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_fun_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_hist</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_hist</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_use_count</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_use_count</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="PlaceholderManager.is_legal_var_name"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.is_legal_var_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_legal_var_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns True iff name is a legal variable name.</span>

<span class="sd">        Legal variable names must be of form `#3` or `-#3` or `#3*.5` or</span>
<span class="sd">        `-#3*.5` where 3 can be replaced by any non-negative int, and .5 can</span>
<span class="sd">        be replaced by anything that can be an argument of float() without</span>
<span class="sd">        throwing an exception. In this example, the 3 that follows the hash</span>
<span class="sd">        character is called the variable number</span>

<span class="sd">        NEW! (functional placeholder variables)</span>

<span class="sd">        Now legal variable names can ALSO be of the form `my_fun#1#2` or</span>
<span class="sd">        `-my_fun#1#2`, where</span>

<span class="sd">        * the 1 and 2 can be replaced by any non-negative integers and there</span>
<span class="sd">        might be any number &gt; 0 of hash variables. Thus, there need not</span>
<span class="sd">        always be precisely 2 hash variables as in the example.</span>

<span class="sd">        * `my_fun` can be replaced by the name of any function with one or</span>
<span class="sd">        more input floats (2 inputs in the example), as long as the first</span>
<span class="sd">        character of the function&#39;s name is a lower case letter.</span>

<span class="sd">        The strings `my_fun#1#2` or `-my_fun#1#2` indicate than one wants to</span>
<span class="sd">        use for the angle being replaced, the values of `my_fun(#1, #2)` or</span>
<span class="sd">        `-my_fun(#1, #2)`, respectively, where the inputs #1 and #2 are</span>
<span class="sd">        floats standing for radians and the output is also a float standing</span>
<span class="sd">        for radians.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">nom</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
            <span class="n">nom</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">nom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">nom</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utg</span><span class="o">.</span><span class="n">is_non_neg_int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># print(&#39;,,&#39;, nom[star_ind+1:])</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">nom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">nom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">utg</span><span class="o">.</span><span class="n">is_non_neg_int</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PlaceholderManager.is_functional_var"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.is_functional_var">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_functional_var</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes var_name is a legal variable name (doesn&#39;t check). Returns</span>
<span class="sd">        True iff var_name is a functional variable name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">var_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">var_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PlaceholderManager.get_leg_var_sign"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.get_leg_var_sign">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_leg_var_sign</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes var_name is a legal variable name (doesn&#39;t check). Returns</span>
<span class="sd">        sign of variable, either +1 or -1</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">var_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span> <span class="k">else</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PlaceholderManager.get_leg_var_var_nums"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.get_leg_var_var_nums">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_leg_var_var_nums</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes var_name is a legal variable name (doesn&#39;t check). Returns a</span>
<span class="sd">        list of the variable numbers</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[int]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_fun_var</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_functional_var</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

        <span class="n">sign</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_sign</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

        <span class="c1"># this gives -1 if &quot;*&quot; not found</span>
        <span class="n">star_ind</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">star_ind</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">star_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

        <span class="c1"># this excludes sign char and scale factor if there is one</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">var_name</span><span class="p">[(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">):</span> <span class="n">star_ind</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
        <span class="c1"># if var_name starts with # or -#, first token will be</span>
        <span class="c1"># empty string so remove it</span>
        <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># create list of variable number strings</span>
        <span class="c1"># this excludes function name if there is one</span>
        <span class="n">var_num_tokens</span> <span class="o">=</span> <span class="n">tokens</span>
        <span class="k">if</span> <span class="n">is_fun_var</span><span class="p">:</span>
            <span class="n">var_num_tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># print(&quot;--&quot;, var_num_tokens)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">var_num_tokens</span><span class="p">]</span></div>

<div class="viewcode-block" id="PlaceholderManager.get_leg_var_fun_name"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.get_leg_var_fun_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_leg_var_fun_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes var_name is a legal variable name (doesn&#39;t check). Returns</span>
<span class="sd">        the function name if there is one or None otherwise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str | None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_fun_var</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_functional_var</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_fun_var</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">sign</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_sign</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>

        <span class="c1"># this finds index of first &quot;#&quot;</span>
        <span class="n">hash_ind</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">var_name</span><span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">:</span> <span class="n">hash_ind</span><span class="p">]</span></div>

<div class="viewcode-block" id="PlaceholderManager.get_leg_var_scale_fac"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.get_leg_var_scale_fac">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_leg_var_scale_fac</span><span class="p">(</span><span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assumes var_name is a legal variable name (doesn&#39;t check). If it&#39;s a</span>
<span class="sd">        functional variable, it returns None. If it&#39;s not a functional</span>
<span class="sd">        variable, it returns the scale factor, the float after the *,</span>
<span class="sd">        if there is a * or a 1 if there is no *</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float | None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_fun_var</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_functional_var</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_fun_var</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># this finds index of first &quot;*&quot;, returns -1 if there is none</span>
        <span class="n">star_ind</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">star_ind</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">var_name</span><span class="p">[</span><span class="n">star_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span></div>

<div class="viewcode-block" id="PlaceholderManager.degs_str_to_rads"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.degs_str_to_rads">[docs]</a>    <span class="k">def</span> <span class="nf">degs_str_to_rads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degs_str</span><span class="p">,</span> <span class="n">line_count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method takes in a string degs_str which might represent either</span>
<span class="sd">        a str() of a float expressing degrees or a legal var name.</span>

<span class="sd">        If degs_str is not a legal_var_name, the method assumes (This</span>
<span class="sd">        assumption is okay because the file was written by SEO_writer so it</span>
<span class="sd">        is always well formed) it&#39;s a str() of a float and returns float(</span>
<span class="sd">        deg_str)*pi/180.</span>

<span class="sd">        If degs_str is a legal variable name, the method tries to resolve it</span>
<span class="sd">        into a rads_value using the 2 dictionaries: self.var_num_to_rads and</span>
<span class="sd">        self.fun_name_to_fun. If it finds a rads_value, the method returns</span>
<span class="sd">        rads_value. If no rads_value can be found, the method outputs the</span>
<span class="sd">        input string unchanged (unless eval_all_vars=True in which case the</span>
<span class="sd">        method aborts).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        degs_str : str</span>
<span class="sd">        line_count : int</span>
<span class="sd">            this is the line_count in the English file being read. This is</span>
<span class="sd">            not used by this function but is used by overrides of it like</span>
<span class="sd">            the one in LoopyPlaceholderManager</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float | str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_legal_var_name</span><span class="p">(</span><span class="n">degs_str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;tried to convert &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>\
                 <span class="o">+</span> <span class="s1">&#39; to a float&#39;</span>

            <span class="k">return</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># is a legal variable name</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_vars</span><span class="p">,</span> <span class="s1">&#39;no circuit variables allowed&#39;</span>

            <span class="n">is_fun_var</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">is_functional_var</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_sign</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>
            <span class="n">scale_fac</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_scale_fac</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>
            <span class="n">fun_name</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_fun_name</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>
            <span class="n">token_var_nums</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">get_leg_var_var_nums</span><span class="p">(</span><span class="n">degs_str</span><span class="p">)</span>

            <span class="c1"># store var numbers and update their use_count</span>
            <span class="k">for</span> <span class="n">var_num</span> <span class="ow">in</span> <span class="n">token_var_nums</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">var_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_var_nums</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_var_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_use_count</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_use_count</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_use_count</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># store function name and update its use_count</span>
            <span class="k">if</span> <span class="n">fun_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fun_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fun_names</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_fun_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fun_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fun_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_use_count</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_use_count</span><span class="p">[</span><span class="n">fun_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_use_count</span><span class="p">[</span><span class="n">fun_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_rads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_rads</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_fun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_fun</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">var_num_to_rads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_rads</span>
            <span class="n">fun_name_to_fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_fun</span>

            <span class="c1"># if there&#39;s a var_num_to_hist, ignore input value of</span>
            <span class="c1"># self.var_num_to_rads. Refill it using the history</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_hist</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">var_num</span> <span class="ow">in</span> <span class="n">token_var_nums</span><span class="p">:</span>
                    <span class="n">var_num_to_rads</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_hist</span><span class="p">[</span><span class="n">var_num</span><span class="p">][</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_use_count</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># if there&#39;s a fun_name_to_hist, ignore input value of</span>
            <span class="c1"># self.fun_name_to_rads. Refill it using the history</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_hist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fun_name</span><span class="p">:</span>
                    <span class="n">fun_name_to_fun</span><span class="p">[</span><span class="n">fun_name</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_hist</span><span class="p">[</span><span class="n">fun_name</span><span class="p">][</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_use_count</span><span class="p">[</span><span class="n">fun_name</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">var_num_to_rads</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_fun_var</span><span class="p">:</span>
                    <span class="c1"># if its not a functional placeholder,</span>
                    <span class="c1"># there is only one fun var</span>
                    <span class="n">var_num</span> <span class="o">=</span> <span class="n">token_var_nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">key_exists</span> <span class="o">=</span> <span class="n">var_num</span> <span class="ow">in</span> <span class="n">var_num_to_rads</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">key_exists</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sign</span><span class="o">*</span><span class="n">var_num_to_rads</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span><span class="o">*</span><span class="n">scale_fac</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># key doesn&#39;t exist</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_all_vars</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;eval_all_vars is True and &quot;</span> <span class="o">+</span>\
                                <span class="s1">&#39;var_num_to_rads has no value for &#39;</span> <span class="o">+</span> \
                                <span class="s1">&#39;variable #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_num</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">degs_str</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is_fun_var</span>
                    <span class="k">if</span> <span class="n">fun_name_to_fun</span><span class="p">:</span>
                        <span class="n">all_var_keys_exist</span> <span class="o">=</span> \
                            <span class="nb">all</span><span class="p">([</span><span class="n">var_num</span> <span class="ow">in</span> <span class="n">var_num_to_rads</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                          <span class="k">for</span> <span class="n">var_num</span> <span class="ow">in</span> <span class="n">token_var_nums</span><span class="p">])</span>
                        <span class="n">fun_key_exists</span> <span class="o">=</span> \
                            <span class="n">fun_name</span> <span class="ow">in</span> <span class="n">fun_name_to_fun</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">all_var_keys_exist</span> <span class="ow">and</span> <span class="n">fun_key_exists</span><span class="p">:</span>
                            <span class="n">arg_float_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_num_to_rads</span><span class="p">[</span><span class="n">var_num</span><span class="p">]</span>
                                              <span class="k">for</span> <span class="n">var_num</span> <span class="ow">in</span> <span class="n">token_var_nums</span><span class="p">]</span>
                            <span class="n">fun</span> <span class="o">=</span> <span class="n">fun_name_to_fun</span><span class="p">[</span><span class="n">fun_name</span><span class="p">]</span>
                            <span class="k">return</span> <span class="n">sign</span><span class="o">*</span><span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="n">arg_float_list</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_all_vars</span><span class="p">:</span>
                                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;eval_all_vars is True and &quot;</span> <span class="o">+</span>\
                                    <span class="s2">&quot;can&#39;t resolve the function &quot;</span> <span class="o">+</span>\
                                    <span class="n">fun_name</span> <span class="o">+</span> \
                                    <span class="s2">&quot; acting on variables &quot;</span> <span class="o">+</span> \
                                    <span class="nb">str</span><span class="p">(</span><span class="n">token_var_nums</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">degs_str</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># no fun_name_to_fun</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_all_vars</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;eval_all_vars is True and &#39;</span> \
                                <span class="s1">&#39;there is no fun_name_to_fun dictionary&#39;</span> <span class="o">+</span> \
                                <span class="s2">&quot; so can&#39;t evaluate &quot;</span> <span class="o">+</span> <span class="n">degs_str</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">degs_str</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># no var_num_to_rads</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_all_vars</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;eval_all_vars is True and &#39;</span> \
                        <span class="s1">&#39;there is no var_num_to_rads dictionary&#39;</span> <span class="o">+</span> \
                        <span class="s2">&quot; so can&#39;t evaluate &quot;</span> <span class="o">+</span> <span class="n">degs_str</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">degs_str</span></div>

<div class="viewcode-block" id="PlaceholderManager.have_resolved_history"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.have_resolved_history">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">have_resolved_history</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function tries to resolve a history. It returns True iff it</span>
<span class="sd">        succeeds.</span>

<span class="sd">        A history of a variable is a list of all the values it will assume</span>
<span class="sd">        all the times it is used in the circuit (each repetition in a loop</span>
<span class="sd">        or nested loops is counted as a different use.) For a hash</span>
<span class="sd">        placeholder, a history is a list of floats or None&#39;s. For a</span>
<span class="sd">        functional placeholder, a history is a list of functions or None&#39;s.</span>

<span class="sd">        Resolving a history successfully means replacing all None&#39;s by a</span>
<span class="sd">        value that is not a None. This is accomplished by moving in order of</span>
<span class="sd">        ascending index on the list and replacing each None by its</span>
<span class="sd">        predecessor. The very first use cannot be a None.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hist : list[float | function | None]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hist</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">hist</span><span class="p">[</span><span class="n">time</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PlaceholderManager.resolve_all_histories"><a class="viewcode-back" href="../../qubiter.PlaceholderManager.html#qubiter.PlaceholderManager.PlaceholderManager.resolve_all_histories">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_all_histories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function tries to resolve the histories of all hash and</span>
<span class="sd">        functional placeholder variables. It aborts if it fails to resolve</span>
<span class="sd">        any of those histories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">val_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_var_nums</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">have_resolved_history</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_num_to_hist</span><span class="p">[</span><span class="n">val_num</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">fun_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fun_names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">PlaceholderManager</span><span class="o">.</span><span class="n">have_resolved_history</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fun_name_to_hist</span><span class="p">[</span><span class="n">fun_name</span><span class="p">])</span></div></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">qubiter.SEO_writer</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">qubiter.SEO_reader</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">qubiter.EchoingSEO_reader</span> <span class="k">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">qubiter.SEO_simulator</span> <span class="k">import</span> <span class="o">*</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="c1"># We begin by writing a simple circuit with 4 qubits. As usual,</span>
        <span class="c1"># the following code will write an English and a Picture file in the</span>
        <span class="c1">#  io_folder directory. Note that some rotation angles have been</span>
        <span class="c1"># entered into the write() Python functions as legal variable names</span>
        <span class="c1"># instead of floats. In the English file, you will see those legal</span>
        <span class="c1"># names where the numerical values of those angles would have been.</span>

        <span class="n">num_bits</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">file_prefix</span> <span class="o">=</span> <span class="s1">&#39;placeholder_test&#39;</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">CktEmbedder</span><span class="p">(</span><span class="n">num_bits</span><span class="p">,</span> <span class="n">num_bits</span><span class="p">)</span>
        <span class="n">wr</span> <span class="o">=</span> <span class="n">SEO_writer</span><span class="p">(</span><span class="n">file_prefix</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_Rx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rads</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_Rx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rads</span><span class="o">=</span><span class="s1">&#39;#2*.5&#39;</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_Rx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rads</span><span class="o">=</span><span class="s1">&#39;my_fun1#2&#39;</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_Rn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rads_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#1&#39;</span><span class="p">,</span> <span class="s1">&#39;-#1*3&#39;</span><span class="p">,</span> <span class="s1">&#39;#3&#39;</span><span class="p">])</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_Rx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rads</span><span class="o">=</span><span class="s1">&#39;-my_fun2#2#1&#39;</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">write_cnot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">close_files</span><span class="p">()</span>

        <span class="c1"># Simply by creating an object of the class SEO_reader with the flag</span>
        <span class="c1">#  `write_log` set equal to True, you can create a log file which</span>
        <span class="c1"># contains</span>
        <span class="c1"># (1) a list of distinct variable numbers</span>
        <span class="c1"># (2) a list of distinct function names</span>
        <span class="c1"># encountered in the English file</span>
        <span class="n">SEO_reader</span><span class="p">(</span><span class="n">file_prefix</span><span class="p">,</span> <span class="n">num_bits</span><span class="p">,</span> <span class="n">write_log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">my_fun1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*.</span><span class="mi">5</span>

        <span class="k">def</span> <span class="nf">my_fun2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

        <span class="c1"># partial substitution, this creates new files</span>
        <span class="c1"># with #1=30, #2=60, &#39;my_fun1&#39;-&gt;my_fun1,</span>
        <span class="c1"># but #3  and &#39;my_fun2&#39; still undecided</span>
        <span class="n">vman</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="p">(</span><span class="n">eval_all_vars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">var_num_to_rads</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">},</span>
                    <span class="n">fun_name_to_fun</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;my_fun1&#39;</span><span class="p">:</span> <span class="n">my_fun1</span><span class="p">})</span>
        <span class="n">wr</span> <span class="o">=</span> <span class="n">SEO_writer</span><span class="p">(</span><span class="n">file_prefix</span> <span class="o">+</span> <span class="s1">&#39;_eval01&#39;</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>
        <span class="n">EchoingSEO_reader</span><span class="p">(</span><span class="n">file_prefix</span><span class="p">,</span> <span class="n">num_bits</span><span class="p">,</span> <span class="n">wr</span><span class="p">,</span>
                          <span class="n">vars_manager</span><span class="o">=</span><span class="n">vman</span><span class="p">)</span>

        <span class="c1"># this runs the simulator after substituting</span>
        <span class="c1"># #1=30, #2=60, #3=90, &#39;my_fun1&#39;-&gt;my_fun1, &#39;my_fun2&#39;-&gt;my_fun2</span>
        <span class="n">vman</span> <span class="o">=</span> <span class="n">PlaceholderManager</span><span class="p">(</span>
            <span class="n">var_num_to_rads</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">},</span>
            <span class="n">fun_name_to_fun</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;my_fun1&#39;</span><span class="p">:</span> <span class="n">my_fun1</span><span class="p">,</span> <span class="s1">&#39;my_fun2&#39;</span><span class="p">:</span> <span class="n">my_fun2</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">SEO_simulator</span><span class="p">(</span><span class="n">file_prefix</span><span class="p">,</span> <span class="n">num_bits</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">vars_manager</span><span class="o">=</span><span class="n">vman</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------------------------------&quot;</span><span class="p">)</span>
        <span class="n">StateVec</span><span class="o">.</span><span class="n">describe_st_vec_dict</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">cur_st_vec_dict</span><span class="p">)</span>

    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Robert R. Tucci &amp; Qubiter contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>